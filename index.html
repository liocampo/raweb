<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no, minimal-ui" />
  <title>RA educativa ‚Äî Demo multi-marcador (PC)</title>

  <!-- Librer√≠as -->
  <script src="https://aframe.io/releases/1.4.1/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/ar.js@3.3.2/aframe/build/aframe-ar-nft.js"></script>

  <style>
    html, body { margin:0; padding:0; overflow:hidden; background:#0b132b; color:#e0e0e0; font-family:system-ui; }
    #hud {
      position: fixed; top: 0; left: 0; right: 0;
      display: flex; gap: .5rem; align-items: center; padding: .5rem .75rem;
      background: rgba(0,0,0,.35); backdrop-filter: blur(4px);
      z-index: 5; font-size: 14px;
    }
    #hud .badge { padding: .2rem .5rem; border-radius: 999px; background: #263159; }
    #hud button { border: 0; padding: .5rem .7rem; border-radius: .6rem; cursor: pointer; background:#1c2541; color:#fff; }
    #hud button:hover { filter: brightness(1.15); }
    #msg {
      position: fixed; bottom: .5rem; left: .5rem; right: .5rem;
      background: rgba(0,0,0,.5); padding: .6rem .8rem; border-radius: .6rem; z-index: 5;
      font-size: 13px; line-height: 1.35;
    }
    #fallback {
      position: fixed; inset: 0; display: none; place-items: center; text-align: center; padding: 1rem;
      background: #0b132b; color: #e0e0e0; z-index: 10;
    }
    .legend {
      position: fixed; right: .5rem; bottom: .5rem; background: rgba(0,0,0,.35);
      padding: .5rem .6rem; border-radius: .6rem; z-index: 5; font-size: 12px;
    }
  </style>
</head>
<body>
  <div id="hud">
    <span class="badge">RA educativa ¬∑ demo multi-marcador</span>
    <button id="btnSnap" title="Descargar captura">üì∏ Capturar</button>
    <button id="btnHelp" title="Ayuda r√°pida">‚ùì Ayuda</button>
    <span style="margin-left:auto"></span>
    <span>Marcadores: <b>hiro</b> (yaguaret√©), <b>kanji</b> (carpincho)</span>
  </div>

  <div id="fallback">
    <div>
      <h2>Necesitamos acceso a la c√°mara</h2>
      <p>Activalo y recarga la p√°gina. Si est√°s en un aula virtual, abr√≠ este recurso en una nueva pesta√±a.</p>
      <p>Como alternativa, pod√©s usar marcadores impresos (hiro / kanji).</p>
    </div>
  </div>

  <div id="msg">Apunt√° con la c√°mara a los marcadores impresos: <b>hiro</b> y <b>kanji</b>.</div>
  <div class="legend">
    <div><b>hiro = ‚ÄúYasi‚Äù (yaguaret√©)</b></div>
    <div><b>kanji = ‚ÄúCapy‚Äù (carpincho)</b></div>
  </div>

  <!-- ESCENA AR -->
  <a-scene 
    vr-mode-ui="enabled: false"
    renderer="antialias: true; alpha: true; precision: mediump"
    embedded
    arjs="sourceType: webcam; debugUIEnabled: false; detectionMode: mono_and_matrix; matrixCodeType: 3x3;">
    
    <a-entity light="type: ambient; color: #BBB"></a-entity>
    <a-entity light="type: directional; color: #FFF; intensity: 0.6" position="0 1 1"></a-entity>

    <!-- Marcadores -->
    <a-marker preset="hiro">
      <a-gltf-model src="assets/jaguar.glb" position="0 0 0" scale="0.5 0.5 0.5" rotation="0 180 0"></a-gltf-model>
      <a-entity position="0 1.2 0" text="value: Yasi ¬∑ yaguaret√©; color: #fff; align: center; width: 2;"></a-entity>
    </a-marker>

    <a-marker preset="kanji">
      <a-gltf-model src="assets/capybara_low_poly.glb" position="0 0 0" scale="0.5 0.5 0.5" rotation="0 180 0"></a-gltf-model>
      <a-entity position="0 1.4 0" text="value: Capy ¬∑ capibara; color: #fff; align: center; width: 2;"></a-entity>
    </a-marker>

    <a-entity camera></a-entity>
  </a-scene>

  <script>
    // Ayuda r√°pida
    document.getElementById('btnHelp').addEventListener('click', () => {
      alert('1) Imprim√≠ los marcadores hiro y kanji.\n2) Permit√≠ el uso de la c√°mara.\n3) Apunt√° los marcadores.\n4) Us√° üì∏ para guardar una captura.');
    });

    // Captura a PNG
    document.getElementById('btnSnap').addEventListener('click', () => {
      try {
        const canvas = document.querySelector('canvas');
        if (!canvas) throw new Error('Canvas no encontrado. Esper√° unos segundos.');
        const a = document.createElement('a');
        a.href = canvas.toDataURL('image/png');
        a.download = 'captura_ra.png';
        document.body.appendChild(a);
        a.click();
        a.remove();
      } catch (e) {
        alert('No se pudo capturar: ' + e.message);
      }
    });

    // Esperar la c√°mara
    setTimeout(() => {
      const hasVideo = !!document.querySelector('video');
      if (!hasVideo) {
        document.getElementById('fallback').style.display = 'grid';
        document.getElementById('msg').textContent = 'No se detect√≥ la c√°mara. Revis√° permisos o us√° otro navegador.';
      }
    }, 6000);
  </script>

  <!-- Bot√≥n manual de permiso -->
  <button id="permisoCam"
    style="position:fixed;top:10px;right:10px;z-index:1000;padding:10px 20px;background:#00bcd4;color:white;border:none;border-radius:8px;">
    üé• Activar c√°mara
  </button>
  <script>
    document.getElementById('permisoCam').addEventListener('click', async () => {
      try {
        const stream = await navigator.mediaDevices.getUserMedia({ video: true });
        stream.getTracks().forEach(t => t.stop());
        alert("‚úÖ C√°mara activada correctamente. Recarg√° la p√°gina.");
      } catch (e) {
        alert("‚ö†Ô∏è Error al activar c√°mara: " + e.message);
      }
    });
  </script>
</body>
</html>
