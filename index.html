<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no, minimal-ui" />
  <title>RA educativa ‚Äî Demo multi-marcador (A-Frame + AR.js)</title>

  <!-- Librer√≠as -->
  <script src="https://aframe.io/releases/1.4.1/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/ar.js@3.3.2/aframe/build/aframe-ar-nft.js"></script>

  <style>
    html, body { margin:0; padding:0; overflow:hidden; background:#0b132b; color:#e0e0e0; font-family: system-ui, sans-serif; }
    #hud {
      position: fixed; top: 0; left: 0; right: 0; 
      display: flex; gap: .5rem; align-items: center; padding: .5rem .75rem;
      background: rgba(0,0,0,.35); backdrop-filter: blur(4px);
      z-index: 5; font-size: 14px;
    }
    #hud .badge { padding: .2rem .5rem; border-radius: 999px; background: #263159; }
    #hud button { border: 0; padding: .5rem .7rem; border-radius: .6rem; cursor: pointer; background:#1c2541; color:#fff; }
    #hud button:hover { filter: brightness(1.15); }
    #msg {
      position: fixed; bottom: .5rem; left: .5rem; right: .5rem;
      background: rgba(0,0,0,.5); padding: .6rem .8rem; border-radius: .6rem; z-index: 5;
      font-size: 13px; line-height: 1.35;
    }
    #fallback {
      position: fixed; inset: 0; display: none; place-items: center; text-align: center; padding: 1rem;
      background: #0b132b; color: #e0e0e0; z-index: 10;
    }
    #fallback a { color: #9ad0f5; }
    .legend {
      position: fixed; right: .5rem; bottom: .5rem; background: rgba(0,0,0,.35);
      padding: .5rem .6rem; border-radius: .6rem; z-index: 5; font-size: 12px;
    }
    .legend b { color: #9ad0f5; }
  </style>
</head>
<body>
  <!-- HUD superior -->
  <div id="hud">
    <span class="badge">RA educativa ¬∑ multi-marcador</span>
    <button id="btnSnap">üì∏ Capturar</button>
    <button id="btnHelp">‚ùì Ayuda</button>
    <span style="margin-left:auto"></span>
    <span>Marcadores: <b>hiro</b> (yaguaret√©), <b>kanji</b> (carpincho)</span>
  </div>

  <div id="fallback">
    <div>
      <h2>Necesitamos acceso a la c√°mara</h2>
      <p>Activalo y recarg√° la p√°gina. Si est√°s en un aula virtual, abr√≠ este recurso en una nueva pesta√±a.</p>
      <p>Pod√©s usar <a href="https://raw.githubusercontent.com/AR-js-org/AR.js/master/data/dataNFT/patterns/hiro.patt" target="_blank">marcadores impresos</a>.</p>
    </div>
  </div>

  <div id="msg">Apunt√° con la c√°mara a los marcadores impresos: <b>hiro</b> y <b>kanji</b>.</div>
  <div class="legend">
    <div><b>hiro = ‚ÄúYasi‚Äù (yaguaret√©)</b> ‚Üí jaguar.glb</div>
    <div><b>kanji = ‚ÄúCapy‚Äù (carpincho)</b> ‚Üí capybara_low_poly.glb</div>
  </div>

  <!-- ESCENA -->
  <a-scene 
    vr-mode-ui="enabled: false"
    renderer="antialias: true; alpha: true; precision: mediump"
    embedded
    arjs="sourceType: webcam; facingMode: environment; debugUIEnabled: false; detectionMode: mono_and_matrix; matrixCodeType: 3x3;"
  >
    <!-- Luces -->
    <a-entity light="type: ambient; color: #BBB"></a-entity>
    <a-entity light="type: directional; color: #FFF; intensity: 0.6" position="0 1 1"></a-entity>

    <!-- Marcadores -->
    <a-marker preset="hiro">
      <a-gltf-model src="assets/jaguar.glb" position="0 0 0" scale="0.5 0.5 0.5"></a-gltf-model>
      <a-entity position="0 1.2 0" text="value: Yasi ¬∑ yaguaret√©; color: #fff; align: center; width: 2;"></a-entity>
    </a-marker>

    <a-marker preset="kanji">
      <a-gltf-model src="assets/capybara_low_poly.glb" position="0 0 0" scale="0.5 0.5 0.5"></a-gltf-model>
      <a-entity position="0 1.4 0" text="value: Capy ¬∑ capibara; color: #fff; align: center; width: 2;"></a-entity>
    </a-marker>

    <a-entity camera></a-entity>
  </a-scene>

  <script>
  // ‚úÖ Forzar c√°mara frontal en notebooks
  window.addEventListener('load', async () => {
    try {
      const devices = await navigator.mediaDevices.enumerateDevices();
      const videoInputs = devices.filter(d => d.kind === 'videoinput');
      const preferFront = videoInputs.find(d => d.label.toLowerCase().includes('front')) || videoInputs[0];
      const stream = await navigator.mediaDevices.getUserMedia({ video: { deviceId: preferFront.deviceId }});
      const video = document.querySelector('video');
      if (video) {
        video.srcObject = stream;
        video.play();
      }
    } catch (err) {
      console.error("Error al iniciar c√°mara:", err);
      document.getElementById('fallback').style.display = 'grid';
    }
  });

  // Mantener c√°mara activa
  setInterval(() => {
    const video = document.querySelector('video');
    if (video && video.paused) video.play().catch(()=>{});
  }, 10000);

  // Captura
  document.getElementById('btnSnap').addEventListener('click', () => {
    const canvas = document.querySelector('canvas');
    if (!canvas) return alert('Esper√° unos segundos m√°s.');
    const a = document.createElement('a');
    a.href = canvas.toDataURL('image/png');
    a.download = 'captura_ra.png';
    a.click();
  });

  // Ayuda
  document.getElementById('btnHelp').addEventListener('click', () => {
    alert([
      '1Ô∏è‚É£ Imprim√≠ los marcadores ‚Äúhiro‚Äù y ‚Äúkanji‚Äù.',
      '2Ô∏è‚É£ Permit√≠ la c√°mara en el navegador.',
      '3Ô∏è‚É£ Apunt√° los marcadores: ver√°s aparecer los modelos 3D.',
      '4Ô∏è‚É£ Us√° üì∏ para guardar una captura.'
    ].join('\n'));
  });
  </script>
</body>
</html>
